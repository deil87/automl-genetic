<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/automl/css/bootstrap.min.css">

    <title>AutoML-genetic Playground</title>
</head>
<body>
<style>

    body {
        font: 12px "Helvetica Neue", Helvetica, Arial, sans-serif;
        position: relative;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .x.axis path {
        display: none;
    }

    .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 1.5px;
    }

    .overlay {
        fill: none;
        pointer-events: all;
    }

    .focus circle {
        fill: steelblue;
    }

    .tooltip {
        width: 94px;
        padding: 4px 10px;
        border: 1px solid #aaa;
        border-radius: 4px;
        box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        position: absolute;
        background-color: white;
        font-size: 14px;
        pointer-events: none;
        -webkit-transition: all 0.25s;
        -moz-transition: all 0.25s;
        -ms-transition: all 0.25s;
        -o-transition: all 0.25s;
        transition: all 0.25s;
    }

    .tooltip div {
        margin: 3px 0;
    }

    .tooltip-date, .tooltip-likes {
        font-weight: bold;
    }

</style>
<div class="container">
    <h1>AutoML Genetic</h1>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

<!--<script type="text/javascript" src="js/d3-dispatch/d3-dispatch.js"></script>
<script type="text/javascript" src="js/d3-selection/d3-selection.js"></script>
<script type="text/javascript" src="js/d3-hierarchy/d3-hierarchy.js"></script>
<script type="text/javascript" src="js/d3-timer/d3-timer.js"></script>
<script type="text/javascript" src="js/d3-interpolate/d3-interpolate.js"></script>
<script type="text/javascript" src="js/d3-color/d3-color.js"></script>
<script type="text/javascript" src="js/d3-ease/d3-ease.js"></script>
<script type="text/javascript" src="js/d3-transition/d3-transition.js"></script>-->
<script src="//d3js.org/d3.v3.min.js"></script>

<br>
<br>

<div id="timeboxes_container"></div>
<div id="line_chart_container"></div>
<div id="table_container"></div>
<!-- Load React. -->
<!-- Note: when deploying, replace "development.js" with "production.min.js". -->
<script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>

<!--<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>-->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel" >

    var ag_global_vars = { }

    var connectToWS = function() {
      var endpoint = 'ws://localhost:8088/ws';
      if (ag_global_vars.myWebSocket !== undefined) {
          ag_global_vars.myWebSocket.close()
      }
      ag_global_vars.myWebSocket = new WebSocket(endpoint);
      ag_global_vars.myWebSocket.onmessage = (event) => {

          var serverDataJson = JSON.parse(event.data);

          var tableRelevantKeys = ["evolutionProgress", "population", "evaluatedTemplateData"]

          if(tableRelevantKeys.includes(serverDataJson.key)) {
            console.log("Forwarding data to tableRef")
            ag_global_vars.tableRef.update(serverDataJson)
          }
          else {
            console.log(JSON.stringify(serverDataJson))
            console.log("Update to other components")

          }

          if(serverDataJson.key == "evolutionProgress") {
            if(typeof serverDataJson.evolution !== 'undefined') {
             updateProgressBar(JSON.stringify(serverDataJson.evolution))
             console.log("Evolution:"+ JSON.stringify(serverDataJson.evolution))
             console.log("Generation:"+ JSON.stringify(serverDataJson.generation))
            }
            console.log(JSON.stringify(serverDataJson))
          }
          if(serverDataJson.key == "timeboxesSetup") {
            steps = ['0', '1', '2'];
          }
      };
      ag_global_vars.myWebSocket.onopen = function(evt) {
          console.log("onopen.");
      };
      ag_global_vars.myWebSocket.onclose = function(evt) {
          console.log("onclose.");
      };
      ag_global_vars.myWebSocket.onerror = function(evt) {
          console.log("Error!");
      };
    }

    var sendMsg = function() {
      var message = document.getElementById("myMessage").value;
      ag_global_vars.myWebSocket.send(message);
      console.log("Time of sending message to server:" + (new Date()).getTime());
    }

    var closeConn = function() {
      ag_global_vars.myWebSocket.close();
    }

    connectToWS()

</script>

<script>

    var colors = { green: '#4DC87F', lightGreen: '#D9F0E3' };
    var width = 960, height = 70, offset = 48;

    width += offset * 2;
    height += offset * 2;
    var dimensions = '' + 0 + ' ' + 0 + ' ' + width + ' ' + height;

    var svg = d3.select('#timeboxes_container').append('svg')
        .attr('id', 'scene', true)
        .attr('preserveAspectRatio', 'xMinYMin meet')
        .attr('viewBox', dimensions)
        .classed('svg-content', true);

    var steps = ['0'];
    stepWidth = (width - offset * 2) / (steps.length - 1),
    currentStep = '0';

    var progressBar = svg.append('g')
                  .attr('transform', 'translate(' + offset + ',' + offset + ')')
                  .style('pointer-events', 'none');

    var progressBackground = progressBar.append('rect')
        .attr('fill', colors.lightGreen)
        .attr('height', 8)
        .attr('width', width - offset * 2)
        .attr('rx', 4)
        .attr('ry', 4);

    var progress = progressBar.append('rect')
        .attr('fill', colors.green)
        .attr('height', 8)
        .attr('width', 0)
        .attr('rx', 4)
        .attr('ry', 4);

    progress.transition()
        .duration(1000)
        .attr('width', function(){
            var index = steps.indexOf(currentStep);
            return (index + 1) * stepWidth;
        });

    progressBar.selectAll('circle')
    .data(steps)
    .enter()
    .append('circle')
    .attr('id', function(d, i){ return 'step_' + i; })
    .attr('cx', function(d, i){ return i * stepWidth; })
    .attr('cy', 4)
    .attr('r', 20)
    .attr('fill', '#FFFFFF')
    .attr('stroke', colors.lightGreen)
    .attr('strokeWidth', 6)

    progressBar.selectAll('text')
    .data(steps)
    .enter()
    .append('text')
    .attr('id', function(d, i){ return 'label_' + i; })
    .attr('dx', function(d, i){ return i * stepWidth; })
    .attr('dy', 10)
    .attr('text-anchor', 'middle')
    .text(function(d, i) { return i + 1; })



    function setupProgressBar(data_){

    var output = [];
    for(var i = 0; i < data_.length; i++){ output.push(data_[i].id.toString()); }
    return output;

    }

    function updateProgressBar(step_){

        progress.transition()
            .duration(1000)
            .attr('fill', colors.green)
            .attr('width', function(){
                var index = steps.indexOf(step_);
                return (index) * stepWidth;
            });

        for(var i = 0; i < steps.length; i++){

            if(i <= steps.indexOf(step_)) {

                d3.select('#step_' + i).attr('fill', colors.green).attr('stroke', colors.green);
                d3.select('#label_' + i).attr('fill', '#FFFFFF');


            } else {

                d3.select('#step_' + i).attr('fill', '#FFFFFF').attr('stroke', colors.lightGreen);
                d3.select('#label_' + i).attr('fill', '#000000');

            }

        }

    }


</script>

<script src="linechart.js" ></script>
<!--<script type="text/babel" src="timeboxes.js" ></script>-->
<script type="text/babel" src="table.js" ></script>

</body>
</html>